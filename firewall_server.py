# www.theforage.com - Telstra Cyber Task 3
# Firewall Server Handler


from http.server import BaseHTTPRequestHandler, HTTPServer
import re

host = "localhost"
port = 8000


#########
# regexp for blocked string
path_regex = re.compile(r"tomcatwar.jsp")
headers_regex = re.compile(r"(suffix=%>//)|(c1=Runtime)|(c2=<%)|(DNT=1)|(Content-Type: application\/x-w>)")

class ServerHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        if path_regex.search(self.path) or headers_regex.search(str(self.headers)):
            self.block_request()  
        else:
            self.handle_request()  

    def do_POST(self):
        if path_regex.search(self.path) or headers_regex.search(str(self.headers)):
            self.block_request()  
        else:
            self.handle_request()  

    def handle_request(self):
        self.send_response(200)
        self.send_header("content-type", "application/json")
        self.end_headers()
    
    def block_request(self):
        self.send_response(403)
        self.send_header("Content-type", "text/html")
        self.end_headers()

if __name__ == "__main__":
    server = HTTPServer((host, port), ServerHandler)
    print("[+] Firewall Server")
    print("[+] HTTP Web Server running on: %s:%s" % (host, port))
    
    
    try:
        server.serve_forever() 
    except KeyboardInterrupt:
        pass
        

    server.server_close()
    print("[+] Server terminated. Exiting...")
    exit(0)
